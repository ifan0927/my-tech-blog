<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content='Today&rsquo;s development focused on adding file handling services to the property management system while implementing architectural improvements for better maintainability and testability.
File Storage Service Implementation Given the current project complexity, I decided to implement local file storage initially while keeping the architecture flexible for future cloud storage migration. The key was designing an abstracted interface that allows seamless provider switching.
package storage import "mime/multipart" // FileStorage defines the interface for file storage operations. // Any storage provider (local disk, S3, GCS, etc.) should implement this interface. type FileStorage interface { // UploadFile saves a file to the storage. // It takes the file header from a multipart form, the desired destination path within the storage, // and returns the full path where the file was stored, or an error. UploadFile(file *multipart.FileHeader, destPath string) (string, error) // GetFile retrieves a file from the storage. // It takes the full storage path of the file and returns the file content as bytes, or an error. // For web services, it might return a direct URL or handle streaming. For now, it returns bytes. GetFile(path string) ([]byte, error) // DeleteFile removes a file from the storage. // It takes the full storage path of the file and returns an error if deletion fails. DeleteFile(path string) error // GetFileTemporaryURL generates a temporary, pre-signed URL for accessing a file. // This is especially useful for cloud storage but can be a direct path for local storage. GetFileTemporaryURL(path string) (string, error) } This approach allows dependency injection during Gin startup, making it easy to swap LocalStorage for CloudStorage when migrating to services like AWS S3 or GCP Storage.
'><meta name=keywords content=",Go,Gin,Microservices,File Storage,Interface Design,Unit Testing,Architecture"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://ifan0927.github.io/my-tech-blog/posts/2025-11-30_note/><title>File Storage Service & Architecture Refactoring for Property Management System :: I-Fan's Tech Blog</title><link rel=stylesheet href=/my-tech-blog/main.min.2729760c629597024c5de34b40ea9f372f2b5a2a192dcdca537b7ddfa483eab8.css integrity="sha256-Jyl2DGKVlwJMXeNLQOqfNy8rWioZLc3KU3t936SD6rg=" crossorigin=anonymous><link rel=apple-touch-icon sizes=180x180 href=/my-tech-blog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/my-tech-blog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/my-tech-blog/favicon-16x16.png><link rel=manifest href=/my-tech-blog/site.webmanifest><link rel=mask-icon href=/my-tech-blog/safari-pinned-tab.svg color><link rel="shortcut icon" href=/my-tech-blog/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="File Storage Service & Architecture Refactoring for Property Management System"><meta itemprop=description content='Today’s development focused on adding file handling services to the property management system while implementing architectural improvements for better maintainability and testability.
File Storage Service Implementation Given the current project complexity, I decided to implement local file storage initially while keeping the architecture flexible for future cloud storage migration. The key was designing an abstracted interface that allows seamless provider switching.
package storage import "mime/multipart" // FileStorage defines the interface for file storage operations. // Any storage provider (local disk, S3, GCS, etc.) should implement this interface. type FileStorage interface { // UploadFile saves a file to the storage. // It takes the file header from a multipart form, the desired destination path within the storage, // and returns the full path where the file was stored, or an error. UploadFile(file *multipart.FileHeader, destPath string) (string, error) // GetFile retrieves a file from the storage. // It takes the full storage path of the file and returns the file content as bytes, or an error. // For web services, it might return a direct URL or handle streaming. For now, it returns bytes. GetFile(path string) ([]byte, error) // DeleteFile removes a file from the storage. // It takes the full storage path of the file and returns an error if deletion fails. DeleteFile(path string) error // GetFileTemporaryURL generates a temporary, pre-signed URL for accessing a file. // This is especially useful for cloud storage but can be a direct path for local storage. GetFileTemporaryURL(path string) (string, error) } This approach allows dependency injection during Gin startup, making it easy to swap LocalStorage for CloudStorage when migrating to services like AWS S3 or GCP Storage.'><meta itemprop=datePublished content="2025-11-30T00:00:00+00:00"><meta itemprop=dateModified content="2025-11-30T00:00:00+00:00"><meta itemprop=wordCount content="580"><meta itemprop=keywords content="Go,Gin,Microservices,File Storage,Interface Design,Unit Testing,Architecture"><meta name=twitter:card content="summary"><meta name=twitter:title content="File Storage Service & Architecture Refactoring for Property Management System"><meta name=twitter:description content='Today’s development focused on adding file handling services to the property management system while implementing architectural improvements for better maintainability and testability.
File Storage Service Implementation Given the current project complexity, I decided to implement local file storage initially while keeping the architecture flexible for future cloud storage migration. The key was designing an abstracted interface that allows seamless provider switching.
package storage import "mime/multipart" // FileStorage defines the interface for file storage operations. // Any storage provider (local disk, S3, GCS, etc.) should implement this interface. type FileStorage interface { // UploadFile saves a file to the storage. // It takes the file header from a multipart form, the desired destination path within the storage, // and returns the full path where the file was stored, or an error. UploadFile(file *multipart.FileHeader, destPath string) (string, error) // GetFile retrieves a file from the storage. // It takes the full storage path of the file and returns the file content as bytes, or an error. // For web services, it might return a direct URL or handle streaming. For now, it returns bytes. GetFile(path string) ([]byte, error) // DeleteFile removes a file from the storage. // It takes the full storage path of the file and returns an error if deletion fails. DeleteFile(path string) error // GetFileTemporaryURL generates a temporary, pre-signed URL for accessing a file. // This is especially useful for cloud storage but can be a direct path for local storage. GetFileTemporaryURL(path string) (string, error) } This approach allows dependency injection during Gin startup, making it easy to swap LocalStorage for CloudStorage when migrating to services like AWS S3 or GCP Storage.'><meta property="article:section" content="Backend Development"><meta property="article:section" content="System Design"><meta property="article:published_time" content="2025-11-30 00:00:00 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/my-tech-blog style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>hello</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/my-tech-blog/about/>about</a></li><li><a href=/my-tech-blog/categories/>categories</a></li><li><a href=/my-tech-blog/posts/>posts</a></li><li><a href=/my-tech-blog/tags/>tags</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
3 minutes</p></div><article><h1 class=post-title><a href=https://ifan0927.github.io/my-tech-blog/posts/2025-11-30_note/>File Storage Service & Architecture Refactoring for Property Management System</a></h1><div class=post-content><p>Today&rsquo;s development focused on adding file handling services to the property management system while implementing architectural improvements for better maintainability and testability.</p><h2 id=file-storage-service-implementation>File Storage Service Implementation</h2><p>Given the current project complexity, I decided to implement local file storage initially while keeping the architecture flexible for future cloud storage migration. The key was designing an abstracted interface that allows seamless provider switching.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>storage</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;mime/multipart&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// FileStorage defines the interface for file storage operations.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Any storage provider (local disk, S3, GCS, etc.) should implement this interface.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FileStorage</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// UploadFile saves a file to the storage.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// It takes the file header from a multipart form, the desired destination path within the storage,</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// and returns the full path where the file was stored, or an error.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>UploadFile</span>(<span style=color:#a6e22e>file</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>multipart</span>.<span style=color:#a6e22e>FileHeader</span>, <span style=color:#a6e22e>destPath</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// GetFile retrieves a file from the storage.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// It takes the full storage path of the file and returns the file content as bytes, or an error.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// For web services, it might return a direct URL or handle streaming. For now, it returns bytes.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>GetFile</span>(<span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>) ([]<span style=color:#66d9ef>byte</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// DeleteFile removes a file from the storage.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// It takes the full storage path of the file and returns an error if deletion fails.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>DeleteFile</span>(<span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// GetFileTemporaryURL generates a temporary, pre-signed URL for accessing a file.</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// This is especially useful for cloud storage but can be a direct path for local storage.</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>GetFileTemporaryURL</span>(<span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This approach allows dependency injection during Gin startup, making it easy to swap LocalStorage for CloudStorage when migrating to services like AWS S3 or GCP Storage.</p><h2 id=architecture-refactoring-insights>Architecture Refactoring Insights</h2><h3 id=service-boundaries-adjustment>Service Boundaries Adjustment</h3><p>Initially, I planned to map each repository to a separate service, but this proved overly complex for a property management system. The business logic naturally aggregates around properties - estate listings need room, lease, and tenant data together. Therefore, allowing <code>estateService</code> to access multiple repositories makes more sense than strict separation.</p><p>However, the file system remains completely independent business-wise, so it deserves its own dedicated service to maintain proper separation of concerns.</p><h3 id=repository-interface-design>Repository Interface Design</h3><p>With growing complexity, I introduced unit testing and dependency injection patterns. This required defining repository interfaces to enable proper mocking:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>property</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;backend/models/property&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// IEstateRepository defines the interface for EstateRepository</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Using &#34;I&#34; prefix to distinguish from Service interfaces</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>IEstateRepository</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>FindAll</span>() ([]<span style=color:#a6e22e>property</span>.<span style=color:#a6e22e>Estate</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>FindByID</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>uint</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>property</span>.<span style=color:#a6e22e>Estate</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Create</span>(<span style=color:#a6e22e>estate</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>property</span>.<span style=color:#a6e22e>Estate</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>property</span>.<span style=color:#a6e22e>Estate</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Update</span>(<span style=color:#a6e22e>estate</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>property</span>.<span style=color:#a6e22e>Estate</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>property</span>.<span style=color:#a6e22e>Estate</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Delete</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>uint</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// IRoomRepository defines the interface for RoomRepository</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>IRoomRepository</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>CountRoomNumber</span>(<span style=color:#a6e22e>estateID</span> <span style=color:#66d9ef>uint</span>) (<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>CountOccupiedByEstateID</span>(<span style=color:#a6e22e>estateID</span> <span style=color:#66d9ef>int</span>) (<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>FindAllWithDetailsByEstateID</span>(<span style=color:#a6e22e>estateID</span> <span style=color:#66d9ef>int</span>) ([]<span style=color:#a6e22e>property</span>.<span style=color:#a6e22e>Room</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>FindAllRoomByEstateId</span>(<span style=color:#a6e22e>estateID</span> <span style=color:#66d9ef>int</span>) ([]<span style=color:#a6e22e>property</span>.<span style=color:#a6e22e>Room</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Additional interfaces follow similar pattern...</span>
</span></span></code></pre></div><h2 id=bootstrap-layer-introduction>Bootstrap Layer Introduction</h2><p>The router layer was becoming unwieldy with all the initialization logic. I extracted this to <code>backend/bootstrap/bootstrap.go</code>, creating an internal container that handles dependency injection during Gin startup. This provides better separation of concerns and easier maintenance.</p><h2 id=testing--code-quality>Testing & Code Quality</h2><p>Introduced unit testing for the service layer and golint to improve code quality and maintainability. The interface-based approach significantly simplifies mocking and testing scenarios.</p><h2 id=completed-features>Completed Features</h2><p>Successfully implemented full CRUD operations for the estate table, providing a solid foundation for the property management system&rsquo;s core functionality.</p><h2 id=next-steps>Next Steps</h2><ul><li>Implement cloud storage providers (AWS S3, GCP Storage) using the established interface</li><li>Expand unit test coverage across all service layers</li><li>Continue refining the bootstrap container for better dependency management</li><li>Add integration tests for the complete file upload workflow</li></ul></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/go/>Go</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/gin/>Gin</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/microservices/>Microservices</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/file-storage/>File Storage</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/interface-design/>Interface Design</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/unit-testing/>Unit Testing</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/architecture/>Architecture</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/categories/backend-development/>Backend Development</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/categories/system-design/>System Design</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
580 Words</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2025-11-30 00:00</p></div><div class=pagination><div class=pagination__buttons><span class="button previous"><a href=https://ifan0927.github.io/my-tech-blog/posts/2025-12-15_note/><span class=button__icon>←</span>
<span class=button__text>Lease Lifecycle Management: CRUD Design for Property Management System</span>
</a></span><span class="button next"><a href=https://ifan0927.github.io/my-tech-blog/posts/2025-11-26_note/><span class=button__text>API Development Workflow & Electric Reading System Implementation</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/my-tech-blog/bundle.min.ad54ad97364f77ede35def9096b162bb1f0b3973aa50b080f5e82fa147f6882e2a7200d7535adbf9b51bebf939f1c1ca9bbe6be87530092aca720eac4a226fda.js integrity="sha512-rVStlzZPd+3jXe+QlrFiux8LOXOqULCA9egvoUf2iC4qcgDXU1rb+bUb6/k58cHKm75r6HUwCSrKcg6sSiJv2g=="></script></body></html>