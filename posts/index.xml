<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on I-Fan's Tech Blog</title><link>https://ifan0927.github.io/my-tech-blog/posts/</link><description>Recent content in Posts on I-Fan's Tech Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><lastBuildDate>Wed, 19 Nov 2025 00:06:34 +0800</lastBuildDate><atom:link href="https://ifan0927.github.io/my-tech-blog/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>DTOs data mapping and Router in Go gin framework</title><link>https://ifan0927.github.io/my-tech-blog/posts/2025_11_18_note/</link><pubDate>Wed, 19 Nov 2025 00:06:34 +0800</pubDate><guid>https://ifan0927.github.io/my-tech-blog/posts/2025_11_18_note/</guid><description>&lt;h2 id="introduction"&gt;Introduction&lt;/h2&gt;
&lt;p&gt;When building REST APIs with Go and Gin framework, two fundamental challenges often emerge: handling data transfer between layers with different nullability requirements, and extracting parameters from HTTP requests. This post walks through practical solutions for DTO mapping with pointer types and demonstrates various parameter extraction patterns in Gin routers.&lt;/p&gt;
&lt;h2 id="understanding-pointer-semantics-in-dto-mapping"&gt;Understanding Pointer Semantics in DTO Mapping&lt;/h2&gt;
&lt;h3 id="the-core-challenge"&gt;The Core Challenge&lt;/h3&gt;
&lt;p&gt;When mapping between domain models and DTOs, mismatched pointer types create compilation errors. Consider this common scenario:&lt;/p&gt;</description><content type="html"><![CDATA[<h2 id="introduction">Introduction</h2>
<p>When building REST APIs with Go and Gin framework, two fundamental challenges often emerge: handling data transfer between layers with different nullability requirements, and extracting parameters from HTTP requests. This post walks through practical solutions for DTO mapping with pointer types and demonstrates various parameter extraction patterns in Gin routers.</p>
<h2 id="understanding-pointer-semantics-in-dto-mapping">Understanding Pointer Semantics in DTO Mapping</h2>
<h3 id="the-core-challenge">The Core Challenge</h3>
<p>When mapping between domain models and DTOs, mismatched pointer types create compilation errors. Consider this common scenario:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Domain Model (Source)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Tenant</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>  <span style="color:#66d9ef">string</span>   <span style="color:#75715e">// Non-pointer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Phone</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">string</span>  <span style="color:#75715e">// Pointer (nullable)</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// DTO (Target)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TenantDto</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span>  <span style="color:#f92672">*</span><span style="color:#66d9ef">string</span>  <span style="color:#75715e">// Pointer (nullable in API)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Phone</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">string</span>  <span style="color:#75715e">// Pointer (nullable in API)</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="three-mapping-scenarios">Three Mapping Scenarios</h3>
<p><strong>Scenario 1: Non-pointer to Pointer</strong></p>
<p>When the source field is a concrete value but the DTO expects a pointer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// ❌ Direct assignment fails</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dto</span>.<span style="color:#a6e22e">Name</span> = <span style="color:#a6e22e">tenant</span>.<span style="color:#a6e22e">Name</span>  <span style="color:#75715e">// Type mismatch</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ✅ Take the address</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dto</span>.<span style="color:#a6e22e">Name</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tenant</span>.<span style="color:#a6e22e">Name</span>
</span></span></code></pre></div><p><strong>Scenario 2: Pointer to Pointer</strong></p>
<p>When both types use pointers, direct assignment works:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// ✅ Direct assignment succeeds</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dto</span>.<span style="color:#a6e22e">Phone</span> = <span style="color:#a6e22e">tenant</span>.<span style="color:#a6e22e">Phone</span>
</span></span></code></pre></div><p><strong>Scenario 3: Pointer to Non-pointer</strong></p>
<p>When the source is nullable but the target isn&rsquo;t, dereference with nil-checking:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// ❌ Direct dereference fails</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dto</span>.<span style="color:#a6e22e">Phone</span> = <span style="color:#a6e22e">tenant</span>.<span style="color:#a6e22e">Phone</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ✅ Safely dereference</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tenant</span>.<span style="color:#a6e22e">Phone</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">dto</span>.<span style="color:#a6e22e">Phone</span> = <span style="color:#f92672">*</span><span style="color:#a6e22e">tenant</span>.<span style="color:#a6e22e">Phone</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="why-this-matters">Why This Matters</h3>
<p>The pattern reveals an important principle: <strong>nullable fields (pointers) require explicit nil-handling</strong>. When converting from optional to required fields, you must decide how to handle absence (default value, error, or skip). When converting required to optional, taking the address is safe because the value always exists.</p>
<h2 id="extracting-parameters-in-gin-routers">Extracting Parameters in Gin Routers</h2>
<h3 id="path-parameters">Path Parameters</h3>
<p>For RESTful resource identifiers embedded in URLs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Route definition</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rooms</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/:id&#34;</span>, <span style="color:#a6e22e">roomHandler</span>.<span style="color:#a6e22e">GetRoomByID</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Handler implementation</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RoomHandler</span>) <span style="color:#a6e22e">GetRoomByID</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Param</span>(<span style="color:#e6db74">&#34;id&#34;</span>)  <span style="color:#75715e">// Extract path parameter</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// id contains &#34;123&#34; from GET /api/property/rooms/123</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="query-parameters">Query Parameters</h3>
<p>For optional filters and modifiers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RoomHandler</span>) <span style="color:#a6e22e">GetRoomByID</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">include</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;include&#34;</span>)          <span style="color:#75715e">// Returns &#34;&#34; if not present</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sort</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">DefaultQuery</span>(<span style="color:#e6db74">&#34;sort&#34;</span>, <span style="color:#e6db74">&#34;name&#34;</span>) <span style="color:#75715e">// Returns &#34;name&#34; if not present</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// From GET /api/property/rooms/123?include=furniture&amp;sort=price</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="multiple-path-parameters">Multiple Path Parameters</h3>
<p>For nested resource hierarchies:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Route definition</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">estates</span>.<span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#34;/:estateId/rooms/:roomId&#34;</span>, <span style="color:#a6e22e">handler</span>.<span style="color:#a6e22e">GetEstateRoom</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Handler implementation</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Handler</span>) <span style="color:#a6e22e">GetEstateRoom</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">estateID</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Param</span>(<span style="color:#e6db74">&#34;estateId&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">roomID</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Param</span>(<span style="color:#e6db74">&#34;roomId&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// From GET /api/property/estates/456/rooms/789</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="type-conversion">Type Conversion</h3>
<p>Path and query parameters arrive as strings. Use <code>strconv</code> for numeric conversions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;strconv&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Param</span>(<span style="color:#e6db74">&#34;id&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">roomID</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">id</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">JSON</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusBadRequest</span>, <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">H</span>{<span style="color:#e6db74">&#34;error&#34;</span>: <span style="color:#e6db74">&#34;Invalid room ID&#34;</span>})
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="error-handling-philosophy">Error Handling Philosophy</h2>
<p>Go&rsquo;s explicit error handling extends to HTTP handlers. Always anticipate failure points:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RoomHandler</span>) <span style="color:#a6e22e">GetRoomByID</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">Context</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 1. Extract and validate input</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">Param</span>(<span style="color:#e6db74">&#34;id&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">roomID</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">id</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">JSON</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusBadRequest</span>, <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">H</span>{<span style="color:#e6db74">&#34;error&#34;</span>: <span style="color:#e6db74">&#34;Invalid ID format&#34;</span>})
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 2. Perform business logic</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">room</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">service</span>.<span style="color:#a6e22e">GetRoom</span>(<span style="color:#a6e22e">roomID</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">JSON</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusInternalServerError</span>, <span style="color:#a6e22e">gin</span>.<span style="color:#a6e22e">H</span>{<span style="color:#e6db74">&#34;error&#34;</span>: <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>()})
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 3. Return success</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">JSON</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StatusOK</span>, <span style="color:#a6e22e">room</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This defensive approach prevents unexpected panics and provides clear error messages to API consumers.</p>
<h2 id="development-workflow-docker-vs-native">Development Workflow: Docker vs Native</h2>
<h3 id="hot-reload-with-air">Hot Reload with Air</h3>
<p>For containerized development, Air enables automatic recompilation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#75715e"># Development Dockerfile</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">golang:1.21</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span> <span style="color:#e6db74">/app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> go install github.com/cosmtrek/air@latest<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> . .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;air&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>However, maintaining separate Dockerfiles for development and production adds complexity. For simple projects, native Go development may be more straightforward—reserve Docker for production deployments and when you need environment parity.</p>
]]></content></item><item><title>2025_11_17_Note</title><link>https://ifan0927.github.io/my-tech-blog/posts/2025_11_17_note/</link><pubDate>Mon, 17 Nov 2025 23:40:50 +0800</pubDate><guid>https://ifan0927.github.io/my-tech-blog/posts/2025_11_17_note/</guid><description>&lt;h1 id="optimizing-database-queries-and-understanding-hash-maps-in-go"&gt;Optimizing Database Queries and Understanding Hash Maps in Go&lt;/h1&gt;
&lt;h2 id="introduction"&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Today&amp;rsquo;s session tackled two common yet crucial challenges in backend development: eliminating the N+1 query problem in a room management API and understanding the proper time complexity approach for the classic Two Sum problem. Both scenarios revealed important lessons about thinking beyond the obvious solution and leveraging the right data structures for optimal performance.&lt;/p&gt;
&lt;h2 id="the-n1-query-problem-in-room-api"&gt;The N+1 Query Problem in Room API&lt;/h2&gt;
&lt;h3 id="identifying-the-anti-pattern"&gt;Identifying the Anti-Pattern&lt;/h3&gt;
&lt;p&gt;While building a room query page API that aggregates data from multiple models, I initially implemented what seemed like straightforward logic:&lt;/p&gt;</description><content type="html"><![CDATA[<h1 id="optimizing-database-queries-and-understanding-hash-maps-in-go">Optimizing Database Queries and Understanding Hash Maps in Go</h1>
<h2 id="introduction">Introduction</h2>
<p>Today&rsquo;s session tackled two common yet crucial challenges in backend development: eliminating the N+1 query problem in a room management API and understanding the proper time complexity approach for the classic Two Sum problem. Both scenarios revealed important lessons about thinking beyond the obvious solution and leveraging the right data structures for optimal performance.</p>
<h2 id="the-n1-query-problem-in-room-api">The N+1 Query Problem in Room API</h2>
<h3 id="identifying-the-anti-pattern">Identifying the Anti-Pattern</h3>
<p>While building a room query page API that aggregates data from multiple models, I initially implemented what seemed like straightforward logic:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Anti-pattern: N+1 Query</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 1. Fetch all rooms (1 query)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rooms</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">roomRepo</span>.<span style="color:#a6e22e">FindAll</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">room</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">rooms</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 2. For each room, fetch its lease (N queries)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lease</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">leaseRepo</span>.<span style="color:#a6e22e">FindByRoomIdAndLeaseIsActive</span>(<span style="color:#a6e22e">room</span>.<span style="color:#a6e22e">ID</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 3. For each lease, fetch tenant (another N queries)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tenant</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">tenantRepo</span>.<span style="color:#a6e22e">FindByLeaseID</span>(<span style="color:#a6e22e">lease</span>.<span style="color:#a6e22e">ID</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This approach executes <code>1 + N + N</code> queries, where N is the number of rooms. For 100 rooms, that&rsquo;s potentially 201 database calls – a significant performance bottleneck.</p>
<h3 id="the-solution-eager-loading-with-preload">The Solution: Eager Loading with Preload</h3>
<p>GORM&rsquo;s <code>Preload</code> feature enables eager loading, fetching all related data in a minimal number of queries:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// FindAllWithDetails uses Preload for eager loading</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Includes active leases, tenants, and billing cycles</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RoomRepository</span>) <span style="color:#a6e22e">FindAllWithDetails</span>() ([]<span style="color:#a6e22e">models</span>.<span style="color:#a6e22e">Room</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rooms</span> []<span style="color:#a6e22e">models</span>.<span style="color:#a6e22e">Room</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">db</span>.
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Preload</span>(<span style="color:#e6db74">&#34;Leases&#34;</span>, <span style="color:#e6db74">&#34;is_active = ?&#34;</span>, <span style="color:#66d9ef">true</span>).
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Preload</span>(<span style="color:#e6db74">&#34;Leases.LeaseTenant.Tenant&#34;</span>).
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Preload</span>(<span style="color:#e6db74">&#34;Leases.BillingCycle&#34;</span>).
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">rooms</span>).<span style="color:#a6e22e">Error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">rooms</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Key Preload Patterns Learned:</strong></p>
<ul>
<li><strong>Basic Loading</strong>: <code>Preload(&quot;Leases&quot;)</code> loads all related leases</li>
<li><strong>Nested Loading</strong>: <code>Preload(&quot;Leases.LeaseTenant.Tenant&quot;)</code> traverses through relationships</li>
<li><strong>Conditional Loading</strong>: <code>Preload(&quot;Leases&quot;, &quot;is_active = ?&quot;, true)</code> applies filters</li>
</ul>
<h3 id="proper-model-associations">Proper Model Associations</h3>
<p>Critical to making Preload work is defining associations correctly in your models:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Room Model excerpt</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// GORM Preload Associations</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// These fields define what can be preloaded from the Room model</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// They don&#39;t create new database columns</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Leases represents all leases for a room</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// []Lease indicates a Room can have multiple Leases (Has Many relationship)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// gorm:&#34;foreignKey:RoomID&#34; tells GORM that the RoomID field in Lease</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// is the foreign key linking to this Room</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// When using db.Preload(&#34;Leases&#34;), GORM queries the Lease table</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// for all records where RoomID matches this Room&#39;s ID</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Leases</span> []<span style="color:#a6e22e">Lease</span> <span style="color:#e6db74">`gorm:&#34;foreignKey:RoomID&#34;`</span>
</span></span></code></pre></div><h2 id="leetcode-two-sum--beyond-the-obvious">LeetCode: Two Sum – Beyond the Obvious</h2>
<h3 id="the-false-two-pointer-solution">The False Two-Pointer Solution</h3>
<p>My initial approach to Two Sum used what I thought was a two-pointer technique, but it was actually a disguised brute force solution with O(n²) complexity:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Inefficient: Still O(n²)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; len(<span style="color:#a6e22e">nums</span>); <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">j</span> &lt; len(<span style="color:#a6e22e">nums</span>); <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">nums</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">+</span> <span style="color:#a6e22e">nums</span>[<span style="color:#a6e22e">j</span>] <span style="color:#f92672">==</span> <span style="color:#a6e22e">target</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> []<span style="color:#66d9ef">int</span>{<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span>}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="the-hash-map-approach">The Hash Map Approach</h3>
<p>The optimal solution leverages a hash map to achieve O(n) time complexity:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">twoSum</span>(<span style="color:#a6e22e">nums</span> []<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">target</span> <span style="color:#66d9ef">int</span>) []<span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">m</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">int</span>]<span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">num</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">nums</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">complement</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">target</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">num</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Check if complement exists and it&#39;s not the same element</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">j</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>[<span style="color:#a6e22e">complement</span>]; <span style="color:#a6e22e">ok</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">i</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> []<span style="color:#66d9ef">int</span>{<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span>}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">m</span>[<span style="color:#a6e22e">num</span>] = <span style="color:#a6e22e">i</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="go-map-syntax-deep-dive">Go Map Syntax Deep Dive</h3>
<p>This problem introduced several important Go map idioms:</p>
<p><strong>1. Two-Value Query:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">j</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>[<span style="color:#a6e22e">complement</span>]
</span></span></code></pre></div><ul>
<li><code>j</code>: the value (index) if key exists</li>
<li><code>ok</code>: boolean indicating key existence</li>
</ul>
<p><strong>2. Existence Check:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">ok</span>  <span style="color:#75715e">// true if complement exists in map</span>
</span></span></code></pre></div><p><strong>3. Element Uniqueness Validation:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">j</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">i</span>  <span style="color:#75715e">// ensures we don&#39;t use the same element twice</span>
</span></span></code></pre></div><p><strong>Combined in Conditional:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">j</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">m</span>[<span style="color:#a6e22e">complement</span>]; <span style="color:#a6e22e">ok</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">i</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> []<span style="color:#66d9ef">int</span>{<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span>}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="key-takeaways">Key Takeaways</h2>
<p><strong>Database Performance:</strong></p>
<ul>
<li>Always be vigilant about N+1 queries when working with ORMs</li>
<li>GORM&rsquo;s Preload is powerful but requires proper model associations</li>
<li>Understand the difference between lazy and eager loading strategies</li>
</ul>
<p><strong>Algorithm Optimization:</strong></p>
<ul>
<li>Don&rsquo;t confuse similar-looking patterns (two-pointer vs. brute force)</li>
<li>Hash maps are often the key to reducing time complexity from O(n²) to O(n)</li>
<li>Go&rsquo;s multi-value return pattern (<code>value, ok := map[key]</code>) is idiomatic for safe map access</li>
</ul>
<hr>
<h2 id="conclusion">Conclusion</h2>
<ol>
<li>Finding N+1 queries problem by seeing the code is quite mess</li>
<li>Maybe Preload is the good way for some cases, but it might pulling out too much unnecessary info , so lazy loading might work sometime</li>
<li>Hashtable is the example of trading space for time</li>
</ol>
]]></content></item></channel></rss>