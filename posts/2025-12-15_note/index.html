<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Today I focused on designing the lease lifecycle management system for a property management application. The main challenge was architecting the complete CRUD operations for lease creation, modification, and termination, with particular attention to the integration between lease management and the accounting system.
Lease Creation: Beyond Simple Database Insertion Creating a lease involves much more than just inserting a record into the leases table. The process requires careful orchestration of multiple operations:
"><meta name=keywords content=",backend-development,database-design,transaction-management,property-management"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://ifan0927.github.io/my-tech-blog/posts/2025-12-15_note/><title>Lease Lifecycle Management: CRUD Design for Property Management System :: I-Fan's Tech Blog</title><link rel=stylesheet href=/my-tech-blog/main.min.2729760c629597024c5de34b40ea9f372f2b5a2a192dcdca537b7ddfa483eab8.css integrity="sha256-Jyl2DGKVlwJMXeNLQOqfNy8rWioZLc3KU3t936SD6rg=" crossorigin=anonymous><link rel=apple-touch-icon sizes=180x180 href=/my-tech-blog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/my-tech-blog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/my-tech-blog/favicon-16x16.png><link rel=manifest href=/my-tech-blog/site.webmanifest><link rel=mask-icon href=/my-tech-blog/safari-pinned-tab.svg color><link rel="shortcut icon" href=/my-tech-blog/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Lease Lifecycle Management: CRUD Design for Property Management System"><meta itemprop=description content="Today I focused on designing the lease lifecycle management system for a property management application. The main challenge was architecting the complete CRUD operations for lease creation, modification, and termination, with particular attention to the integration between lease management and the accounting system.
Lease Creation: Beyond Simple Database Insertion Creating a lease involves much more than just inserting a record into the leases table. The process requires careful orchestration of multiple operations:"><meta itemprop=datePublished content="2025-12-15T00:00:00+00:00"><meta itemprop=dateModified content="2025-12-15T00:00:00+00:00"><meta itemprop=wordCount content="702"><meta itemprop=keywords content="Backend Development,Database Design,Transaction-Management,Property-Management"><meta name=twitter:card content="summary"><meta name=twitter:title content="Lease Lifecycle Management: CRUD Design for Property Management System"><meta name=twitter:description content="Today I focused on designing the lease lifecycle management system for a property management application. The main challenge was architecting the complete CRUD operations for lease creation, modification, and termination, with particular attention to the integration between lease management and the accounting system.
Lease Creation: Beyond Simple Database Insertion Creating a lease involves much more than just inserting a record into the leases table. The process requires careful orchestration of multiple operations:"><meta property="article:section" content="Backend Architecture"><meta property="article:published_time" content="2025-12-15 00:00:00 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/my-tech-blog style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>hello</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/my-tech-blog/about/>about</a></li><li><a href=/my-tech-blog/categories/>categories</a></li><li><a href=/my-tech-blog/posts/>posts</a></li><li><a href=/my-tech-blog/tags/>tags</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
4 minutes</p></div><article><h1 class=post-title><a href=https://ifan0927.github.io/my-tech-blog/posts/2025-12-15_note/>Lease Lifecycle Management: CRUD Design for Property Management System</a></h1><div class=post-content><p>Today I focused on designing the lease lifecycle management system for a property management application. The main challenge was architecting the complete CRUD operations for lease creation, modification, and termination, with particular attention to the integration between lease management and the accounting system.</p><h2 id=lease-creation-beyond-simple-database-insertion>Lease Creation: Beyond Simple Database Insertion</h2><p>Creating a lease involves much more than just inserting a record into the <code>leases</code> table. The process requires careful orchestration of multiple operations:</p><h3 id=pre-validation-requirements>Pre-validation Requirements</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Essential checks before lease creation</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>LeaseService</span>) <span style=color:#a6e22e>CreateLease</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>req</span> <span style=color:#a6e22e>CreateLeaseRequest</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tx</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>BeginTx</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>Rollback</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Lock room record to prevent race conditions</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>room</span> <span style=color:#a6e22e>Room</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>QueryRowContext</span>(<span style=color:#a6e22e>ctx</span>, 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;SELECT id, is_available FROM rooms WHERE id = ? FOR UPDATE&#34;</span>, 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>RoomID</span>).<span style=color:#a6e22e>Scan</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>room</span>.<span style=color:#a6e22e>ID</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>room</span>.<span style=color:#a6e22e>IsAvailable</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>room</span>.<span style=color:#a6e22e>IsAvailable</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ErrRoomNotAvailable</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Validate tenants exist</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ... tenant validation logic</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=bill-generation-strategy>Bill Generation Strategy</h3><p>The core principle is <strong>predictable accounting</strong>. However, different bill types require different approaches:</p><ul><li><p><strong>Rent Bills</strong>: Since rental amounts and cycles are fixed, I generate <strong>all future rent bills</strong> immediately upon lease creation with <code>status = 'pending'</code>. This makes future queries and collections straightforward.</p></li><li><p><strong>Electricity Bills</strong>: Unlike rent bills, electricity billing cycles are determined by actual <strong>meter reading dates</strong>, not calendar dates. Therefore, <strong>no electricity bills are pre-generated</strong> during lease creation. Instead, I store the <code>initial_electric_reading</code> in the lease record as the baseline for future calculations.</p></li></ul><h2 id=lease-modification-keeping-it-simple>Lease Modification: Keeping It Simple</h2><p>Lease updates present a critical design decision: what changes should be allowed?</p><h3 id=core-vs-non-core-changes>Core vs Non-Core Changes</h3><p><strong>Core changes</strong> (room changes, rent adjustments, lease period modifications) would severely impact pre-generated bills and create complex reconciliation scenarios. The solution: <strong>treat core changes as &ldquo;terminate old lease + create new lease&rdquo;</strong>.</p><p><strong>Non-core changes</strong> (contact updates, notes, secondary tenant modifications) can be safely handled through direct updates:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>LeaseService</span>) <span style=color:#a6e22e>UpdateLease</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>leaseID</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>req</span> <span style=color:#a6e22e>UpdateLeaseRequest</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tx</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>BeginTx</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>Rollback</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Lock lease record</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>ExecContext</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;SELECT id FROM leases WHERE id = ? FOR UPDATE&#34;</span>, <span style=color:#a6e22e>leaseID</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Handle tenant relationship changes</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>TenantIDs</span>) &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Compare existing vs new tenant lists</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Delete removed associations, insert new ones</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Update simple fields</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>ExecContext</span>(<span style=color:#a6e22e>ctx</span>, 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;UPDATE leases SET notes = ?, updated_at = NOW() WHERE id = ?&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Notes</span>, <span style=color:#a6e22e>leaseID</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>Commit</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=lease-termination-the-complex-settlement-process>Lease Termination: The Complex Settlement Process</h2><p>Termination is the most sophisticated operation in the lease lifecycle, involving complete financial settlement.</p><h3 id=event-driven-final-billing>Event-Driven Final Billing</h3><p>The <strong>final meter reading</strong> serves as the critical trigger event:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>LeaseService</span>) <span style=color:#a6e22e>TerminateLease</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>req</span> <span style=color:#a6e22e>TerminateLeaseRequest</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tx</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>BeginTx</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>Rollback</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Generate final electricity bill based on final reading</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>finalBill</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>generateFinalElectricityBill</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>LeaseID</span>, <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>FinalElectricReading</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Void all future pending rent bills</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>tx</span>.<span style=color:#a6e22e>ExecContext</span>(<span style=color:#a6e22e>ctx</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;UPDATE rent_bills SET status = &#39;void&#39; WHERE lease_id = ? AND status = &#39;pending&#39; AND due_date &gt; ?&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>LeaseID</span>, <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>TerminationDate</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=multi-entry-accounting-records>Multi-Entry Accounting Records</h3><p>Settlement involves multiple financial transactions with different natures:</p><ul><li>Deposit refund (expense)</li><li>Electricity bill collection (income)</li><li>Damage compensation (income)</li></ul><p>Each transaction type requires <strong>separate accounting entries</strong> to maintain clear financial records:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Multiple accounting entries for different transaction types</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>accountingEntries</span> <span style=color:#f92672>:=</span> []<span style=color:#a6e22e>AccountingEntry</span>{
</span></span><span style=display:flex><span>    {<span style=color:#a6e22e>Type</span>: <span style=color:#e6db74>&#34;expense&#34;</span>, <span style=color:#a6e22e>Amount</span>: <span style=color:#a6e22e>depositRefund</span>, <span style=color:#a6e22e>Description</span>: <span style=color:#e6db74>&#34;Deposit refund&#34;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#a6e22e>Type</span>: <span style=color:#e6db74>&#34;income&#34;</span>, <span style=color:#a6e22e>Amount</span>: <span style=color:#a6e22e>finalElectricityBill</span>, <span style=color:#a6e22e>Description</span>: <span style=color:#e6db74>&#34;Final electricity charge&#34;</span>},
</span></span><span style=display:flex><span>    {<span style=color:#a6e22e>Type</span>: <span style=color:#e6db74>&#34;income&#34;</span>, <span style=color:#a6e22e>Amount</span>: <span style=color:#a6e22e>damageCompensation</span>, <span style=color:#a6e22e>Description</span>: <span style=color:#e6db74>&#34;Damage compensation&#34;</span>},
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=challenges--solutions>Challenges & Solutions</h2><p><strong>Challenge</strong>: Race conditions during lease creation when multiple users attempt to rent the same room.
<strong>Solution</strong>: Implemented <code>SELECT ... FOR UPDATE</code> to lock room records during the transaction.</p><p><strong>Challenge</strong>: Handling different billing cycles for rent vs utilities.
<strong>Solution</strong>: Adopted an event-driven approach where rent bills are pre-generated but electricity bills are created based on actual meter reading events.</p><p><strong>Challenge</strong>: Managing complex termination settlements with multiple financial components.
<strong>Solution</strong>: Designed a comprehensive transaction that handles bill voidance, final bill generation, settlement calculation, and multi-entry accounting records atomically.</p><h2 id=next-steps>Next Steps</h2><p>The lease lifecycle design provides a solid foundation for the property management system. The next phase will focus on implementing the actual service layer with proper error handling, testing the transaction boundaries under concurrent access, and integrating with the front-end lease management interface.</p></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/backend-development/>backend-development</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/database-design/>database-design</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/transaction-management/>transaction-management</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/property-management/>property-management</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/categories/backend-architecture/>Backend Architecture</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
702 Words</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2025-12-15 00:00</p></div><div class=pagination><div class=pagination__buttons><span class="button next"><a href=https://ifan0927.github.io/my-tech-blog/posts/2025-11-30_note/><span class=button__text>File Storage Service & Architecture Refactoring for Property Management System</span>
<span class=button__icon>â†’</span></a></span></div></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/my-tech-blog/bundle.min.ad54ad97364f77ede35def9096b162bb1f0b3973aa50b080f5e82fa147f6882e2a7200d7535adbf9b51bebf939f1c1ca9bbe6be87530092aca720eac4a226fda.js integrity="sha512-rVStlzZPd+3jXe+QlrFiux8LOXOqULCA9egvoUf2iC4qcgDXU1rb+bUb6/k58cHKm75r6HUwCSrKcg6sSiJv2g=="></script></body></html>