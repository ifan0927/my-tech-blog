<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="Today&rsquo;s development focused on clarifying Go pointer concepts and optimizing database queries in the log management API. The main achievement was replacing individual database queries with batch operations to improve performance.
Go Pointer Concepts and DTO Mapping Gained better understanding of pointer handling in Go, particularly for DTO mapping scenarios:
Key principle: Always check the source data type first &: Takes the address (gets pointer) *: Dereferences (gets value) Critical consideration: When source is a pointer, always check for nil before operations Type conversion with pointers: Must dereference first, then assign to correct pointer type This understanding is crucial for safe DTO transformations and avoiding runtime panics.
"><meta name=keywords content=",go,pointers,database-optimization,api-development"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://ifan0927.github.io/my-tech-blog/posts/2024-11-25_note/><title>Go Pointer Handling and Query Optimization in Log Management API :: I-Fan's Tech Blog</title><link rel=stylesheet href=/my-tech-blog/main.min.2729760c629597024c5de34b40ea9f372f2b5a2a192dcdca537b7ddfa483eab8.css integrity="sha256-Jyl2DGKVlwJMXeNLQOqfNy8rWioZLc3KU3t936SD6rg=" crossorigin=anonymous><link rel=apple-touch-icon sizes=180x180 href=/my-tech-blog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/my-tech-blog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/my-tech-blog/favicon-16x16.png><link rel=manifest href=/my-tech-blog/site.webmanifest><link rel=mask-icon href=/my-tech-blog/safari-pinned-tab.svg color><link rel="shortcut icon" href=/my-tech-blog/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Go Pointer Handling and Query Optimization in Log Management API"><meta itemprop=description content="Today’s development focused on clarifying Go pointer concepts and optimizing database queries in the log management API. The main achievement was replacing individual database queries with batch operations to improve performance.
Go Pointer Concepts and DTO Mapping Gained better understanding of pointer handling in Go, particularly for DTO mapping scenarios:
Key principle: Always check the source data type first &: Takes the address (gets pointer) *: Dereferences (gets value) Critical consideration: When source is a pointer, always check for nil before operations Type conversion with pointers: Must dereference first, then assign to correct pointer type This understanding is crucial for safe DTO transformations and avoiding runtime panics."><meta itemprop=datePublished content="2025-11-25T00:00:00+00:00"><meta itemprop=dateModified content="2025-11-25T00:00:00+00:00"><meta itemprop=wordCount content="453"><meta itemprop=keywords content="Go,Pointers,Database-Optimization,Api-Development"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go Pointer Handling and Query Optimization in Log Management API"><meta name=twitter:description content="Today’s development focused on clarifying Go pointer concepts and optimizing database queries in the log management API. The main achievement was replacing individual database queries with batch operations to improve performance.
Go Pointer Concepts and DTO Mapping Gained better understanding of pointer handling in Go, particularly for DTO mapping scenarios:
Key principle: Always check the source data type first &: Takes the address (gets pointer) *: Dereferences (gets value) Critical consideration: When source is a pointer, always check for nil before operations Type conversion with pointers: Must dereference first, then assign to correct pointer type This understanding is crucial for safe DTO transformations and avoiding runtime panics."><meta property="article:section" content="backend-development"><meta property="article:section" content="performance"><meta property="article:published_time" content="2025-11-25 00:00:00 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=/my-tech-blog style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>hello</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/my-tech-blog/about/>about</a></li><li><a href=/my-tech-blog/categories/>categories</a></li><li><a href=/my-tech-blog/posts/>posts</a></li><li><a href=/my-tech-blog/tags/>tags</a></li></ul></nav><span class=menu-trigger><svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
3分鐘</p></div><article><h1 class=post-title><a href=https://ifan0927.github.io/my-tech-blog/posts/2024-11-25_note/>Go Pointer Handling and Query Optimization in Log Management API</a></h1><div class=post-content><p>Today&rsquo;s development focused on clarifying Go pointer concepts and optimizing database queries in the log management API. The main achievement was replacing individual database queries with batch operations to improve performance.</p><h2 id=go-pointer-concepts-and-dto-mapping>Go Pointer Concepts and DTO Mapping</h2><p>Gained better understanding of pointer handling in Go, particularly for DTO mapping scenarios:</p><ul><li><strong>Key principle</strong>: Always check the source data type first</li><li><strong><code>&</code></strong>: Takes the address (gets pointer)</li><li><strong><code>*</code></strong>: Dereferences (gets value)</li><li><strong>Critical consideration</strong>: When source is a pointer, always check for <code>nil</code> before operations</li><li><strong>Type conversion with pointers</strong>: Must dereference first, then assign to correct pointer type</li></ul><p>This understanding is crucial for safe DTO transformations and avoiding runtime panics.</p><h2 id=database-query-optimization>Database Query Optimization</h2><h3 id=problem>Problem</h3><p>The original log management GET list API was inefficient - it fetched log IDs first, then performed individual queries for each accounting record.</p><h3 id=solution>Solution</h3><p>Implemented batch querying strategy to reduce database roundtrips:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>managementLogService</span>) <span style=color:#a6e22e>GetManagementLogListByEstateId</span>(<span style=color:#a6e22e>estateId</span> <span style=color:#66d9ef>int</span>) ([]<span style=color:#a6e22e>dto</span>.<span style=color:#a6e22e>LogsListResponse</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// TODO: Add pagination and filtering</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 1. Get all management logs</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>managementLogs</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>managementLogRepo</span>.<span style=color:#a6e22e>FindByEstateId</span>(uint(<span style=color:#a6e22e>estateId</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Failed to fetch management logs&#34;</span>, <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>Int</span>(<span style=color:#e6db74>&#34;estateId&#34;</span>, <span style=color:#a6e22e>estateId</span>), <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>managementLogs</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> []<span style=color:#a6e22e>dto</span>.<span style=color:#a6e22e>LogsListResponse</span>{}, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 2. Collect all log IDs</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>logIDs</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>uint</span>, <span style=color:#ae81ff>0</span>, len(<span style=color:#a6e22e>managementLogs</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>log</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>managementLogs</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>logIDs</span> = append(<span style=color:#a6e22e>logIDs</span>, <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>ID</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 3. Batch fetch all related accounting records</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>allAccountings</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>accountRepo</span>.<span style=color:#a6e22e>FindByLogIDs</span>(<span style=color:#a6e22e>logIDs</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Failed to fetch accountings for logs&#34;</span>, <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>Uints</span>(<span style=color:#e6db74>&#34;logIDs&#34;</span>, <span style=color:#a6e22e>logIDs</span>), <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 4. Group accounting records by log ID</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>accountingMap</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>uint</span>][]<span style=color:#a6e22e>property</span>.<span style=color:#a6e22e>Accounting</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>acc</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>allAccountings</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>acc</span>.<span style=color:#a6e22e>SourceID</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>accountingMap</span>[<span style=color:#f92672>*</span><span style=color:#a6e22e>acc</span>.<span style=color:#a6e22e>SourceID</span>] = append(<span style=color:#a6e22e>accountingMap</span>[<span style=color:#f92672>*</span><span style=color:#a6e22e>acc</span>.<span style=color:#a6e22e>SourceID</span>], <span style=color:#a6e22e>acc</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 5. Compose final results</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> make([]<span style=color:#a6e22e>dto</span>.<span style=color:#a6e22e>LogsListResponse</span>, <span style=color:#ae81ff>0</span>, len(<span style=color:#a6e22e>managementLogs</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>log</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>managementLogs</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Get corresponding accounting records from map (nil slice is safe if not found)</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>logAccountings</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>accountingMap</span>[<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>ID</span>]
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>result</span> = append(<span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>dto</span>.<span style=color:#a6e22e>ToLogListItemDto</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>log</span>, <span style=color:#a6e22e>logAccountings</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Performance benefits</strong>:</p><ul><li>Reduced N+1 query problem to 2 queries total</li><li>Used in-memory grouping instead of multiple database calls</li><li>Maintained data consistency with safe nil pointer handling</li></ul><h2 id=development-environment-improvements>Development Environment Improvements</h2><p>The development workflow has significantly improved after implementing remote development setup:</p><ul><li><strong>Unified environment</strong>: No more device switching concerns</li><li><strong>Database consistency</strong>: Eliminated synchronization issues between local environments</li><li><strong>Reduced context switching</strong>: Focus on development rather than environment management</li></ul><p>Database migration is still managed through Go migrations for version control, though the up/down migration process could be more streamlined.</p><h2 id=next-steps>Next Steps</h2><ol><li><strong>Add pagination support</strong> to the log management API</li><li><strong>Implement filtering mechanisms</strong> for better query flexibility</li><li><strong>Optimize migration workflow</strong> to reduce manual intervention</li><li><strong>Consider caching strategies</strong> for frequently accessed log data</li></ol><p>The current batch query approach provides a solid foundation for these enhancements while maintaining good performance characteristics.</p><pre tabindex=0><code></code></pre></div></article><hr><div class=post-info><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/go/>go</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/pointers/>pointers</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/database-optimization/>database-optimization</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/tags/api-development/>api-development</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/categories/backend-development/>backend-development</a></span>
<span class=tag><a href=https://ifan0927.github.io/my-tech-blog/categories/performance/>performance</a></span></p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
453字</p><p><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2025-11-25 00:00</p></div><div class=pagination><div class=pagination__buttons><span class="button previous"><a href=https://ifan0927.github.io/my-tech-blog/posts/2025-11-25_note/><span class=button__icon>←</span>
<span class=button__text>Building n8n Automation Workflow for Hugo Blog Content Generation</span>
</a></span><span class="button next"><a href=https://ifan0927.github.io/my-tech-blog/posts/2025_11_24_note/><span class=button__text>Setting Up a Production-Ready Mac Mini M4 Development Environment</span>
<span class=button__icon>→</span></a></span></div></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/my-tech-blog/bundle.min.ad54ad97364f77ede35def9096b162bb1f0b3973aa50b080f5e82fa147f6882e2a7200d7535adbf9b51bebf939f1c1ca9bbe6be87530092aca720eac4a226fda.js integrity="sha512-rVStlzZPd+3jXe+QlrFiux8LOXOqULCA9egvoUf2iC4qcgDXU1rb+bUb6/k58cHKm75r6HUwCSrKcg6sSiJv2g=="></script></body></html>